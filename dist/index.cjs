"use strict";var b=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var d=Object.prototype.hasOwnProperty;var _=(s,e)=>{for(var t in e)b(s,t,{get:e[t],enumerable:!0})},P=(s,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of g(e))!d.call(s,n)&&n!==t&&b(s,n,{get:()=>e[n],enumerable:!(o=K(e,n))||o.enumerable});return s};var V=s=>P(b({},"__esModule",{value:!0}),s);var R={};_(R,{Store:()=>p});module.exports=V(R);var v=require("events"),f=require("lmdbx"),p=class extends v.EventEmitter{env;dbs;constructor(e,t){super(),this.env=(0,f.open)(e,t),this._patch(this.env,"root"),this.dbs=new Map}_patch(e,t){let o=e.put.bind(e),n=e.remove.bind(e),m=this;function l(a,i,r,u){let c;return o(a,i,r,u).then(y=>{typeof r=="number"&&(c=r);let D=e.getBinary(a);return m.emit("change",{type:"put",bucket:t,id:a,value:D,version:c}),y})}function h(a,i){let r;typeof i=="number"&&(r=i);let u=e.get(a);return m.emit("change",{type:"remove",bucket:t,id:a,value:u,version:r}),n(a,i)}e.put=l,e.remove=h}bucket(e,t){let o=this.dbs.get(e);if(!o){let n={cache:!0,...t};o=this.env.openDB(e,n),this.dbs.set(e,o),this._patch(o,e)}return o}};0&&(module.exports={Store});
//# sourceMappingURL=index.cjs.map